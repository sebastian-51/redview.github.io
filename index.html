<!DOCTYPE html>
<html lang="es" data-lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üõ∞Ô∏è REDVIEWER - Observaciones Espaciales</title>

  <!-- Firebase SDK (Base de datos) -->
  <script src="https://www.gstatic.com/firebasejs/12.9.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.9.0/firebase-database-compat.js"></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      color: #fff;
      line-height: 1.6;
      padding-bottom: 70px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      position: relative;
      overflow-x: hidden;
    }

    /* Fondo animado de estrellas */
    #stars-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }

    .star {
      position: absolute;
      background-color: #fff;
      border-radius: 50%;
      animation: twinkle var(--duration) infinite ease-in-out;
      opacity: var(--opacity);
      width: var(--size);
      height: var(--size);
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.2; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.2); }
    }

    :root{
      --bgGlass: rgba(255, 255, 255, 0.08);
      --borderGlass: rgba(255, 255, 255, 0.12);
      --accent1: #667eea;
      --accent2: #764ba2;
      --accent3: #f093fb;
      --muted: #a0a0c0;
      --danger1: #ff6b6b;
      --danger2: #ee5a24;
    }

    /* Ajustar z-index del contenido para que est√© sobre las estrellas */
    .navbar, .hero, .stats-bar, .feed-container, footer, .modal {
      position: relative;
      z-index: 10;
    }

    /* ================= NAVBAR ================= */
    .navbar {
      background: rgba(15, 12, 41, 0.95);
      padding: 14px 5%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.5);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      gap: 12px;
    }

    .logo {
      font-size: 1.55em;
      font-weight: 800;
      color: var(--accent1);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 10px;
      white-space: nowrap;
    }

    .nav-right {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .nav-links {
      display: flex;
      gap: 18px;
      align-items: center;
      flex-wrap: wrap;
    }

    .nav-links a {
      color: #fff;
      text-decoration: none;
      font-weight: 600;
      transition: color 0.3s;
      font-size: 0.98em;
      white-space: nowrap;
    }
    .nav-links a:hover { color: var(--accent1); }

    .lang-select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background: rgba(11, 11, 11, 0.08);
      border: 1px solid rgba(102,126,234,0.35);
      color: #f6f6f6;
      padding: 8px 12px;    
      border-radius: 12px;
      cursor: pointer;
      font-weight: 700;
      font-size: 0.92em;
      outline: none;
    }
    .lang-select:focus{
      border-color:#764ba2;
      box-shadow:0 0 12px rgba(118,75,162,0.5);
      background-color:#25224a;
    }
    .lang-select option{
      background-color:#1e1b37;
      color:#fff;
    }

    .lang-wrap { position: relative; }
    .lang-wrap::after{
      content: "‚ñæ";
      position: absolute;
      left: calc(100% - 22px);
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
      color: rgba(249, 247, 247, 0.923);
      font-size: 0.9em;
    }
   .lang-select { padding-right: 28px; }
    
.lang-select option{
    padding-right: 28px;
  background-color:#1e1b37;
  color:#fff;
}

    .auth-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }

    .btn {
      padding: 8px 18px;
      border: none;
      border-radius: 999px;
      cursor: pointer;
      font-weight: 800;
      transition: transform 0.2s, box-shadow 0.2s, background 0.2s, border-color 0.2s;
      font-size: 0.95em;
      white-space: nowrap;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    .btn-login {
      background: transparent;
      border: 2px solid var(--accent1);
      color: var(--accent1);
    }
    .btn-login:hover { background: rgba(102, 126, 234, 0.1); }

    .btn-signup {
      background: linear-gradient(45deg, var(--accent1), var(--accent2));
      color: white;
    }
    .btn-signup:hover {
      transform: translateY(-1px);
      box-shadow: 0 5px 14px rgba(102, 126, 234, 0.4);
    }

    .btn-logout {
      background: linear-gradient(45deg, var(--danger1), var(--danger2));
      color: white;
    }

    .hamburger {
      display: none;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      color: #fff;
      border-radius: 12px;
      padding: 10px 12px;
      cursor: pointer;
      line-height: 1;
      font-size: 1.05em;
      -webkit-tap-highlight-color: transparent;
    }

    .mobile-menu {
      display: none;
      width: 100%;
      background: rgba(15, 12, 41, 0.98);
      border-top: 1px solid rgba(255,255,255,0.08);
      padding: 12px 5% 14px;
      position: relative;
      z-index: 1000;
    }
    .mobile-menu.active { display: block; }
    .mobile-menu .nav-links {
      flex-direction: column;
      align-items: flex-start;
      gap: 10px;
      padding: 8px 0 10px;
    }
    .mobile-menu .auth-buttons {
      width: 100%;
      gap: 10px;
    }
    .mobile-menu .btn { width: 100%; }

    /* ================= HERO ================= */
    .hero {
      text-align: center;
      padding: 56px 16px 38px;
      background: linear-gradient(rgba(15, 12, 41, 0.7), rgba(48, 43, 99, 0.8));
      background-size: cover;
      background-position: center;
    }

    .hero h1 {
      font-size: clamp(1.9rem, 4.2vw, 2.7rem);
      margin-bottom: 12px;
      background: linear-gradient(45deg, var(--accent1), var(--accent2), var(--accent3));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 900;
      letter-spacing: 0.2px;
    }

    .hero p {
      font-size: clamp(1.02rem, 2.3vw, 1.15rem);
      color: var(--muted);
      max-width: 720px;
      margin: 0 auto 22px;
      line-height: 1.75;
      padding: 0 6px;
    }

    .hero-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 18px;
    }

    .btn-explore {
      background: linear-gradient(45deg, var(--accent1), var(--accent2));
      color: white;
      padding: 12px 30px;
      font-size: 1em;
    }
    .btn-explore:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(102, 126, 234, 0.45);
    }

    /* ================= Secci√≥n de estadisticas ================= */
    .stats-bar {
      background: rgba(15, 12, 41, 0.9);
      padding: 12px 5%;
      display: flex;
      justify-content: center;
      gap: 26px;
      flex-wrap: wrap;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .stat-item { text-align: center; min-width: 110px; }
    .stat-number { font-size: 1.4em; font-weight: 900; color: var(--accent1); }
    .stat-label { color: var(--muted); font-size: 0.85em; white-space: nowrap; }

    /* ================= Nuestro contenido ================= */
    .feed-container {
      max-width: 980px;
      margin: 32px auto;
      padding: 0 14px;
    }

    .feed-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 22px;
      padding-bottom: 14px;
      border-bottom: 2px solid rgba(255, 255, 255, 0.1);
      gap: 12px;
      flex-wrap: wrap;
    }

    .feed-title { font-size: 1.75em; color: var(--accent1); font-weight: 900; }
    .create-btn {
      background: linear-gradient(45deg, var(--accent1), var(--accent2));
      color: white;
      padding: 10px 22px;
      border: none;
      border-radius: 999px;
      cursor: pointer;
      font-weight: 900;
      font-size: 0.95em;
      transition: transform 0.2s, box-shadow 0.2s;
      white-space: nowrap;
    }
    .create-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 5px 14px rgba(102, 126, 234, 0.4);
    }

    .posts-grid { display: flex; flex-direction: column; gap: 18px; }

    .post-card {
      background: var(--bgGlass);
      border-radius: 16px;
      padding: 18px;
      border: 1px solid var(--borderGlass);
      transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
      position: relative;
      overflow: hidden;
      cursor: pointer;
      touch-action: manipulation;
    }
    .post-card::before {
      content: '';
      position: absolute;
      top: 0; left: 0;
      width: 4px; height: 100%;
      background: linear-gradient(180deg, var(--accent1), var(--accent2));
    }
    .post-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 22px rgba(0, 0, 0, 0.35);
      border-color: rgba(102, 126, 234, 0.3);
    }

    .post-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }
    .post-avatar {
      width: 44px; height: 44px;
      border-radius: 50%;
      background: linear-gradient(45deg, var(--accent1), var(--accent2));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 900;
      font-size: 1.05em;
      flex-shrink: 0;
    }
    .post-info { flex: 1; min-width: 0; }
    .post-username {
      font-weight: 900;
      font-size: 1.05em;
      color: var(--accent1);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .post-time { color: var(--muted); font-size: 0.85em; white-space: nowrap; }

    .post-content {
      margin-bottom: 12px;
      line-height: 1.75;
      font-size: 0.97em;
      word-wrap: break-word;
      overflow-wrap: anywhere;
    }

    .post-image {
      width: 100%;
      border-radius: 12px;
      margin: 12px 0 6px;
      max-height: 380px;
      object-fit: cover;
      border: 1px solid rgba(255, 255, 255, 0.12);
    }

    .post-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 12px 0 6px;
      padding: 8px 10px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      flex-wrap: wrap;
      gap: 8px;
    }
    .post-type {
      background: linear-gradient(45deg, var(--accent1), var(--accent2));
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.85em;
      font-weight: 900;
      white-space: nowrap;
    }
    .post-location {
      color: var(--accent3);
      font-size: 0.85em;
      display: flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }

    .post-actions {
      display: flex;
      justify-content: space-between;
      margin-top: 14px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      padding-top: 10px;
      flex-wrap: wrap;
      gap: 8px;
    }

    .action-btn {
      flex: 1;
      min-width: 92px;
      padding: 10px 6px;
      border: 1px solid rgba(255,255,255,0.08);
      background: rgba(255,255,255,0.03);
      color: var(--muted);
      cursor: pointer;
      font-weight: 900;
      transition: transform 0.15s, color 0.2s, border-color 0.2s;
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 0.9em;
      border-radius: 12px;
      -webkit-tap-highlight-color: transparent;
    }
    .action-btn:hover { color: var(--accent1); border-color: rgba(102,126,234,0.35); transform: translateY(-1px); }
    .action-count { font-size: 0.9em; font-weight: 900; }

    /* ================= Footer ================= */
    footer {
      background: rgba(10, 8, 27, 0.95);
      padding: 24px 5%;
      text-align: center;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: 28px;
      font-size: 0.92em;
      position: relative;
      z-index: 10;
    }
    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
      gap: 22px;
      margin-bottom: 18px;
    }
    .footer-section h3 {
      color: var(--accent1);
      margin-bottom: 12px;
      font-size: 1.12em;
      line-height: 1.35;
    }
    .footer-section a {
      color: var(--muted);
      text-decoration: none;
      display: block;
      margin: 7px 0;
      transition: color 0.3s;
      font-size: 0.96em;
    }
    .footer-section a:hover { color: var(--accent1); }
    .copyright {
      margin-top: 12px;
      color: var(--muted);
      padding-top: 14px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    .creator-name { color: var(--accent1); font-weight: 900; }
    .creator-russian { color: var(--accent2); font-weight: 900; margin-top: 3px; display: block; font-size: 0.95em; }

    /* ================= Cargar ================= */
    .loading-container { text-align: center; padding: 40px 20px; color: var(--muted); }
    .loading-spinner {
      width: 40px; height: 40px;
      border: 4px solid rgba(102, 126, 234, 0.3);
      border-top-color: var(--accent1);
      border-radius: 50%;
      margin: 0 auto 15px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ================= MODALES ================= */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(15, 12, 41, 0.95);
      z-index: 2000;
      justify-content: center;
      align-items: center;
      padding: 16px;
      animation: fadeIn 0.2s ease;
    }
    .modal.active { display: flex; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .modal-content {
      background: rgba(30, 27, 55, 0.98);
      border-radius: 18px;
      width: 100%;
      max-width: 620px;
      max-height: 88vh;
      display: flex;
      flex-direction: column;
      border: 1px solid rgba(102, 126, 234, 0.3);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
      animation: slideUp 0.22s ease;
      position: relative;
      z-index: 2010;
    }
    @keyframes slideUp { from { transform: translateY(18px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    .modal-header {
      padding: 18px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
      gap: 10px;
    }
    .modal-title { font-size: 1.22em; color: var(--accent1); font-weight: 900; }
    .modal-close {
      background: none; border: none;
      color: var(--muted); font-size: 1.8em;
      cursor: pointer; transition: color 0.3s; line-height: 1;
    }
    .modal-close:hover { color: var(--danger1); }

    .modal-post-preview {
      padding: 14px 18px;
      background: rgba(255, 255, 255, 0.03);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 0.92em; color: var(--muted);
      max-height: 110px; overflow-y: auto; flex-shrink: 0;
    }

    .modal-comments {
      flex: 1; overflow-y: auto; padding: 14px 18px;
      display: flex; flex-direction: column; gap: 12px;
    }

    .comment-item {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px; padding: 12px 14px;
      display: flex; gap: 10px; animation: fadeIn 0.15s ease;
    }
    .comment-avatar {
      width: 34px; height: 34px; border-radius: 50%;
      background: linear-gradient(45deg, var(--accent1), var(--accent2));
      display: flex; align-items: center; justify-content: center;
      font-weight: 900; font-size: 0.9em; flex-shrink: 0;
    }
    .comment-body { flex: 1; min-width: 0; }
    .comment-header {
      display: flex; justify-content: space-between;
      align-items: center; margin-bottom: 4px; gap: 10px; flex-wrap: wrap;
    }
    .comment-username { font-weight: 900; color: var(--accent1); font-size: 0.95em; }
    .comment-time { color: #888; font-size: 0.8em; }
    .comment-text { color: #e0e0ff; font-size: 0.95em; line-height: 1.5; overflow-wrap: anywhere; }
    .comment-empty { text-align: center; color: var(--muted); padding: 28px 18px; font-size: 0.95em; }

    .modal-comment-form {
      padding: 14px 18px 18px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      display: flex; gap: 10px; flex-shrink: 0;
    }
    .comment-input {
      flex: 1; background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(102, 126, 234, 0.3);
      border-radius: 999px; padding: 12px 16px;
      color: #fff; font-size: 0.95em; outline: none;
      transition: border-color 0.3s;
    }
    .comment-input:focus { border-color: var(--accent1); }
    .comment-input::placeholder { color: #9a9ab5; }
    .comment-send {
      background: linear-gradient(45deg, var(--accent1), var(--accent2));
      color: white; border: none; border-radius: 999px;
      padding: 12px 18px; font-weight: 900;
      cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;
      white-space: nowrap;
    }
    .comment-send:hover {
      transform: translateY(-1px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.35);
    }
    .comment-send:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

    /* Scroll personalizado */
    .modal-comments::-webkit-scrollbar, .modal-post-preview::-webkit-scrollbar { width: 6px; }
    .modal-comments::-webkit-scrollbar-track, .modal-post-preview::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); border-radius: 3px; }
    .modal-comments::-webkit-scrollbar-thumb, .modal-post-preview::-webkit-scrollbar-thumb { background: linear-gradient(45deg, var(--accent1), var(--accent2)); border-radius: 3px; }

    /* Nuevo modal de detalle de post  */
    #postDetailModal .modal-content {
      max-width: 700px;
    }

    #postDetailContent {
      max-height: none;
      overflow-y: auto;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 16px;
      background: transparent;
      border-bottom: none;
    }

    #postDetailActions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      padding: 14px 18px;
      border-top: 1px solid rgba(255,255,255,0.1);
    }

    /* ================= Responsive ================= */
    @media (max-width: 900px) {
      .navbar { padding: 12px 4%; }
      .nav-links { gap: 14px; }
    }

    @media (max-width: 768px) {
      .nav-links, .auth-buttons { display: none; }
      .hamburger { display: inline-flex; align-items: center; justify-content: center; }
      .nav-right { gap: 8px; }
      .lang-select { padding: 9px 28px 9px 12px; }
      .hero { padding-top: 46px; }
      .stats-bar { gap: 16px; padding: 10px 4%; }
      .feed-container { padding: 0 12px; }
      .create-btn { width: 100%; }
      .post-card { padding: 16px; }
      .action-btn { min-width: 0; }
      .modal-content { max-height: 92vh; border-radius: 16px; }
      .modal-comment-form { flex-direction: column; }
      .comment-send { width: 100%; }
    }

    @media (max-width: 420px) {
      .logo { font-size: 1.35em; }
      .stat-item { min-width: 96px; }
      .post-actions { flex-direction: column; }
      .action-btn { width: 100%; }
    }
  </style>
</head>
<body>
  <!-- Contenedor de estrellas animadas -->
  <div id="stars-container"></div>

  <!-- barra de navegaci√≥n -->
  <nav class="navbar">
    <a href="index.html" class="logo">üõ∞Ô∏è REDVIEWER</a>

    <div class="nav-right">
      <div class="lang-wrap">
        <select class="lang-select" id="languageSelect" aria-label="Select language">
          <option value="es">ES</option>
          <option value="en">EN</option>
          <option value="ru">RU</option>
        </select>
      </div>

      <button class="hamburger" id="hamburgerBtn" aria-label="Open menu">‚ò∞</button>

      <div class="nav-links" id="desktopNav">
        <a href="index.html" data-i18n="nav_home">Inicio</a>
        <a href="profile.html" data-i18n="nav_profile">Perfil</a>
        <a href="create-post.html" data-i18n="nav_new">Nueva Observaci√≥n</a>
        <a href="faq.html" style="display:flex;align-items:center;gap:5px;" data-i18n="nav_help">‚ùì Ayuda</a>
      </div>

      <div class="auth-buttons" id="authButtons">
        <button class="btn btn-login" onclick="window.location.href='login.html'" data-i18n="btn_login">Iniciar Sesi√≥n</button>
        <button class="btn btn-signup" onclick="window.location.href='register.html'" data-i18n="btn_signup">Registrarse</button>
      </div>

      <div class="auth-buttons" id="userButtons" style="display:none;">
        <span id="userNameDisplay" style="color: var(--accent1); font-weight: 900; margin-right: 6px; font-size: 0.95em;"></span>
        <button class="btn btn-logout" onclick="logout()" data-i18n="btn_logout">Cerrar Sesi√≥n</button>
      </div>
    </div>
  </nav>

  <!-- Menu de parte del tel√©fono -->
  <div class="mobile-menu" id="mobileMenu">
    <div class="nav-links">
      <a href="index.html" data-i18n="nav_home">Inicio</a>
      <a href="profile.html" data-i18n="nav_profile">Perfil</a>
      <a href="create-post.html" data-i18n="nav_new">Nueva Observaci√≥n</a>
      <a href="faq.html" style="display:flex;align-items:center;gap:5px;" data-i18n="nav_help">‚ùì Ayuda</a>
    </div>

    <div class="auth-buttons" id="authButtonsMobile">
      <button class="btn btn-login" onclick="window.location.href='login.html'" data-i18n="btn_login">Iniciar Sesi√≥n</button>
      <button class="btn btn-signup" onclick="window.location.href='register.html'" data-i18n="btn_signup">Registrarse</button>
    </div>

    <div class="auth-buttons" id="userButtonsMobile" style="display:none;">
      <button class="btn btn-logout" onclick="logout()" data-i18n="btn_logout">Cerrar Sesi√≥n</button>
    </div>
  </div>

  <!-- Secci√≥n hero -->
  <section class="hero">
    <h1 data-i18n="hero_title">Observa el Cielo, Comparte el Espacio</h1>
    <p data-i18n="hero_subtitle">
      √önete a la comunidad global de observadores de sat√©lites. Comparte tus avistamientos, fotos y descubre lo que otros est√°n viendo en tiempo real.
    </p>

    <div class="hero-buttons">
      <button class="btn btn-explore" onclick="window.location.href='#feed'" data-i18n="btn_explore">Explorar Observaciones</button>
      <button class="btn btn-signup" id="heroSignupBtn"
        onclick="window.location.href='register.html'"
        style="background: transparent; border: 2px solid white; color: white;"
        data-i18n="btn_join_free">
        √önete Gratis
      </button>
    </div>
  </section>

  <!-- Barra de stats -->
  <div class="stats-bar">
    <div class="stat-item">
      <div class="stat-number" id="totalPosts">0</div>
      <div class="stat-label" data-i18n="stat_posts">Observaciones</div>
    </div>
    <div class="stat-item">
      <div class="stat-number" id="totalUsers">0</div>
      <div class="stat-label" data-i18n="stat_users">Observadores</div>
    </div>
    <div class="stat-item">
      <div class="stat-number" id="totalLikes">0</div>
      <div class="stat-label" data-i18n="stat_likes">Me Gusta</div>
    </div>
    <div class="stat-item">
      <div class="stat-number" id="totalComments">0</div>
      <div class="stat-label" data-i18n="stat_comments">Comentarios</div>
    </div>
  </div>

  <!-- Secci√≥n feed -->
  <section class="feed-container" id="feed">
    <div class="feed-header">
      <h2 class="feed-title" data-i18n="feed_title">üì° √öltimas Observaciones</h2>
      <button class="create-btn" id="createPostBtn" data-i18n="btn_new_post">‚ûï Nueva Observaci√≥n</button>
    </div>

    <div class="posts-grid" id="postsGrid">
      <div class="loading-container">
        <div class="loading-spinner"></div>
        <p data-i18n="loading_posts">Cargando observaciones...</p>
      </div>
    </div>
  </section>

  <!-- Pie de p√°gina -->
  <footer>
    <div class="footer-content">
      <div class="footer-section">
        <h3>REDVIEWER</h3>
        <h3 data-i18n="footer_quote_es">Y Aunque Eramos de Distintas Galaxias, Tu Fuerza de Atracci√≥n Me Sacaba de √ìrbita</h3>
        <h3 data-i18n="footer_quote_ru">–≤—Å–µ —á—Ç–æ –º–Ω–µ –Ω—É–∂–Ω–æ —ç—Ç–æ —Ç—ã!</h3>
        <p data-i18n="footer_tagline_1">La red social de grandes observadores del espacio</p>
        <p data-i18n="footer_tagline_2">Conectando las Estrellas con la Tierra</p>
      </div>

      <div class="footer-section">
        <h3 data-i18n="footer_links">Enlaces</h3>
        <a href="index.html" data-i18n="nav_home">Inicio</a>
        <a href="profile.html" data-i18n="footer_profile">Tu Perfil</a>
        <a href="create-post.html" data-i18n="nav_new">Nueva Observaci√≥n</a>
        <a href="faq.html" data-i18n="footer_faq">‚ùì Preguntas Frecuentes</a>
      </div>

      <div class="footer-section">
        <h3 data-i18n="footer_help">Ayuda</h3>
        <a href="faq.html#satelites" data-i18n="footer_guide">Gu√≠a de Observaci√≥n</a>
        <a href="faq.html#contacto" data-i18n="footer_contact">Contacto</a>
        <a href="faq.html#preguntas" data-i18n="footer_support">Soporte T√©cnico</a>
      </div>

      <div class="footer-section">
        <h3 data-i18n="footer_legal">Legal</h3>
        <a href="#" data-i18n="footer_terms">T√©rminos y Condiciones</a>
        <a href="#" data-i18n="footer_privacy">Pol√≠tica de Privacidad</a>
        <a href="#" data-i18n="footer_cookies">Cookies</a>
      </div>
    </div>

    <div class="copyright">
      <p data-i18n="footer_created_by">Creado por <span class="creator-name">Sebastian Sifuentes Zavala</span></p>
      <p class="creator-russian">–°–æ–∑–¥–∞–Ω–æ –°–µ–±–∞—Å—Ç—å—è–Ω–æ–º –°–∏—Ñ—É—ç–Ω—Ç–µ—Å –ó–∞–≤–∞–ª–∞</p>
      <p>&copy; 2026 REDVIEWER. <span data-i18n="footer_rights">Todos los derechos reservados.</span></p>
      <p>&copy; 2026 REDVIEWER. <span data-i18n="footer_rights_ru">–í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</span></p>
    </div>
  </footer>

  <!-- ===== MODAL DE COMENTARIOS ===== -->
  <div id="commentsModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" data-i18n="modal_comments_title">üí¨ Comentarios</h3>
        <button class="modal-close" onclick="closeCommentsModal()">&times;</button>
      </div>

      <div class="modal-post-preview" id="modalPostPreview" data-i18n="modal_loading_post">
        Cargando observaci√≥n...
      </div>

      <div class="modal-comments" id="modalCommentsList">
        <div class="comment-empty" data-i18n="modal_no_comments">üöÄ S√© el primero en comentar esta observaci√≥n</div>
      </div>

      <form class="modal-comment-form" id="commentForm" onsubmit="submitComment(event)">
        <input type="text" class="comment-input" id="commentInput" placeholder="Escribe tu comentario..." maxlength="500" required data-i18n-placeholder="comment_placeholder">
        <button type="submit" class="comment-send" id="commentSendBtn" data-i18n="btn_send">Enviar</button>
      </form>
    </div>
  </div>

  <!-- ===== MODAL DE DETALLE DE PUBLICACI√ìN ===== -->
  <div id="postDetailModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" data-i18n="post_detail_title">üî≠ Detalle de Observaci√≥n</h3>
        <button class="modal-close" onclick="closePostDetailModal()">&times;</button>
      </div>
      <div id="postDetailContent" class="modal-post-preview" style="max-height: none; overflow-y: auto; flex: 1; display: flex; flex-direction: column; gap: 16px;">
        <div class="loading-container">
          <div class="loading-spinner"></div>
          <p data-i18n="loading_post">Cargando...</p>
        </div>
      </div>
      <div id="postDetailActions" class="modal-comment-form" style="justify-content: flex-end; gap: 12px; display: none;">
        <!-- Botones de acci√≥n para el propietario (Editar/Eliminar) -->
      </div>
    </div>
  </div>

  <script>
    // ========= INiciamos script para los idiomas (ES/EN/RU) =========
    const I18N = {
      es: {
        nav_home: "Inicio",
        nav_profile: "Perfil",
        nav_new: "Nueva Observaci√≥n",
        nav_help: "‚ùì Ayuda",
        btn_login: "Iniciar Sesi√≥n",
        btn_signup: "Registrarse",
        btn_logout: "Cerrar Sesi√≥n",

        hero_title: "Observa el Cielo, Comparte el Espacio",
        hero_subtitle: "√önete a la comunidad global de observadores de sat√©lites. Comparte tus avistamientos, fotos y descubre lo que otros est√°n viendo en tiempo real.",
        btn_explore: "Explorar Observaciones",
        btn_join_free: "√önete Gratis",

        stat_posts: "Observaciones",
        stat_users: "Observadores",
        stat_likes: "Me Gusta",
        stat_comments: "Comentarios",

        feed_title: "üì° √öltimas Observaciones",
        btn_new_post: "‚ûï Nueva Observaci√≥n",
        loading_posts: "Cargando observaciones...",

        empty_title: "üöÄ No hay observaciones todav√≠a",
        empty_sub: "S√© el primero en compartir tu avistamiento",
        empty_create_first: "‚ûï Crear Primera Observaci√≥n",
        empty_login_publish: "üîê Iniciar Sesi√≥n para Publicar",

        err_connection: "‚ùå Error de conexi√≥n",
        retry: "‚Üª Reintentar",

        share_label: "Compartir",
        date_not_specified: "Fecha no especificada",
        location_not_specified: "Ubicaci√≥n no especificada",

        modal_comments_title: "üí¨ Comentarios",
        modal_loading_post: "Cargando observaci√≥n...",
        modal_no_comments: "üöÄ S√© el primero en comentar esta observaci√≥n",
        comment_placeholder: "Escribe tu comentario...",
        btn_send: "Enviar",
        sending: "Enviando...",

        must_login_comment: "üîê Debes iniciar sesi√≥n para comentar",
        copied_link: "¬°Enlace copiado al portapapeles!",
        could_not_send: "‚ùå No se pudo enviar el comentario. Intenta de nuevo.",

        footer_links: "Enlaces",
        footer_profile: "Tu Perfil",
        footer_faq: "‚ùì Preguntas Frecuentes",
        footer_help: "Ayuda",
        footer_guide: "Gu√≠a de Observaci√≥n",
        footer_contact: "Contacto",
        footer_support: "Soporte T√©cnico",
        footer_legal: "Legal",
        footer_terms: "T√©rminos y Condiciones",
        footer_privacy: "Pol√≠tica de Privacidad",
        footer_cookies: "Cookies",
        footer_tagline_1: "La red social de grandes observadores del espacio",
        footer_tagline_2: "Conectando las Estrellas con la Tierra",
        footer_quote_es: "Y Aunque Eramos de Distintas Galaxias, Tu Fuerza de Atracci√≥n Me Sacaba de √ìrbita",
        footer_quote_ru: "–≤—Å–µ —á—Ç–æ –º–Ω–µ –Ω—É–∂–Ω–æ —ç—Ç–æ —Ç—ã!",
        footer_created_by: "Creado por <span class='creator-name'>Sebastian Sifuentes Zavala</span>",
        footer_rights: "Todos los derechos reservados.",
        footer_rights_ru: "–í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.",

        // Nuevas claves para el modal de detalle y edici√≥n
        post_detail_title: "üî≠ Detalle de Observaci√≥n",
        loading_post: "Cargando...",
        edit_btn: "Editar",
        delete_btn: "Eliminar",
        cancel_btn: "Cancelar",
        save_btn: "Guardar",
        description: "Descripci√≥n",
        object_type: "Tipo de objeto",
        location: "Ubicaci√≥n",
        type_satellite: "Sat√©lite",
        type_iss: "ISS",
        type_starlink: "Starlink",
        type_rocket: "Cohete",
        type_meteor: "Meteorito",
        type_space_debris: "Basura Espacial",
        type_other: "Otro"
      },

      en: {
        nav_home: "Home",
        nav_profile: "Profile",
        nav_new: "New Sighting",
        nav_help: "‚ùì Help",
        btn_login: "Log In",
        btn_signup: "Sign Up",
        btn_logout: "Log Out",

        hero_title: "Watch the Sky, Share Space",
        hero_subtitle: "Join a global community of satellite watchers. Share sightings, photos, and discover what others are seeing in real time.",
        btn_explore: "Explore Sightings",
        btn_join_free: "Join for Free",

        stat_posts: "Sightings",
        stat_users: "Observers",
        stat_likes: "Likes",
        stat_comments: "Comments",

        feed_title: "üì° Latest Sightings",
        btn_new_post: "‚ûï New Sighting",
        loading_posts: "Loading sightings...",

        empty_title: "üöÄ No sightings yet",
        empty_sub: "Be the first to share your observation",
        empty_create_first: "‚ûï Create First Sighting",
        empty_login_publish: "üîê Log In to Post",

        err_connection: "‚ùå Connection error",
        retry: "‚Üª Retry",

        share_label: "Share",
        date_not_specified: "Date not specified",
        location_not_specified: "Location not specified",

        modal_comments_title: "üí¨ Comments",
        modal_loading_post: "Loading post...",
        modal_no_comments: "üöÄ Be the first to comment on this sighting",
        comment_placeholder: "Write your comment...",
        btn_send: "Send",
        sending: "Sending...",

        must_login_comment: "üîê You must log in to comment",
        copied_link: "Link copied to clipboard!",
        could_not_send: "‚ùå Could not send the comment. Try again.",

        footer_links: "Links",
        footer_profile: "Your Profile",
        footer_faq: "‚ùì FAQ",
        footer_help: "Help",
        footer_guide: "Observation Guide",
        footer_contact: "Contact",
        footer_support: "Tech Support",
        footer_legal: "Legal",
        footer_terms: "Terms & Conditions",
        footer_privacy: "Privacy Policy",
        footer_cookies: "Cookies",
        footer_tagline_1: "A social network for serious space observers",
        footer_tagline_2: "Connecting Stars to Earth",
        footer_quote_es: "And even if we were from different galaxies, your gravity pulled me out of orbit",
        footer_quote_ru: "–≤—Å–µ —á—Ç–æ –º–Ω–µ –Ω—É–∂–Ω–æ —ç—Ç–æ —Ç—ã!",
        footer_created_by: "Created by <span class='creator-name'>Sebastian Sifuentes Zavala</span>",
        footer_rights: "All rights reserved.",
        footer_rights_ru: "All rights reserved.",

        post_detail_title: "üî≠ Observation Details",
        loading_post: "Loading...",
        edit_btn: "Edit",
        delete_btn: "Delete",
        cancel_btn: "Cancel",
        save_btn: "Save",
        description: "Description",
        object_type: "Object Type",
        location: "Location",
        type_satellite: "Satellite",
        type_iss: "ISS",
        type_starlink: "Starlink",
        type_rocket: "Rocket",
        type_meteor: "Meteor",
        type_space_debris: "Space Debris",
        type_other: "Other"
      },

      ru: {
        nav_home: "–ì–ª–∞–≤–Ω–∞—è",
        nav_profile: "–ü—Ä–æ—Ñ–∏–ª—å",
        nav_new: "–ù–∞–±–ª—é–¥–µ–Ω–∏–µ",
        nav_help: "‚ùì –ü–æ–º–æ—â—å",
        btn_login: "–í–æ–π—Ç–∏",
        btn_signup: "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è",
        btn_logout: "–í—ã–π—Ç–∏",

        hero_title: "–°–º–æ—Ç—Ä–∏ –≤ –Ω–µ–±–æ ‚Äî –¥–µ–ª–∏—Å—å –∫–æ—Å–º–æ—Å–æ–º",
        hero_subtitle: "–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ –≥–ª–æ–±–∞–ª—å–Ω–æ–º—É —Å–æ–æ–±—â–µ—Å—Ç–≤—É –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª–µ–π —Å–ø—É—Ç–Ω–∏–∫–æ–≤. –î–µ–ª–∏—Å—å –Ω–∞–±–ª—é–¥–µ–Ω–∏—è–º–∏, —Ñ–æ—Ç–æ –∏ —Å–º–æ—Ç—Ä–∏, —á—Ç–æ –≤–∏–¥—è—Ç –¥—Ä—É–≥–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.",
        btn_explore: "–°–º–æ—Ç—Ä–µ—Ç—å –Ω–∞–±–ª—é–¥–µ–Ω–∏—è",
        btn_join_free: "–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è",

        stat_posts: "–ù–∞–±–ª—é–¥–µ–Ω–∏—è",
        stat_users: "–ù–∞–±–ª—é–¥–∞—Ç–µ–ª–∏",
        stat_likes: "–õ–∞–π–∫–∏",
        stat_comments: "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏",

        feed_title: "üì° –ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è",
        btn_new_post: "‚ûï –ù–æ–≤–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ",
        loading_posts: "–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π...",

        empty_title: "üöÄ –ü–æ–∫–∞ –Ω–µ—Ç –Ω–∞–±–ª—é–¥–µ–Ω–∏–π",
        empty_sub: "–ë—É–¥—å –ø–µ—Ä–≤—ã–º ‚Äî –ø–æ–¥–µ–ª–∏—Å—å —Å–≤–æ–∏–º –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ–º",
        empty_create_first: "‚ûï –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ",
        empty_login_publish: "üîê –í–æ–π—Ç–∏, —á—Ç–æ–±—ã –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å",

        err_connection: "‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è",
        retry: "‚Üª –ü–æ–≤—Ç–æ—Ä–∏—Ç—å",

        share_label: "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è",
        date_not_specified: "–î–∞—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞",
        location_not_specified: "–õ–æ–∫–∞—Ü–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞",

        modal_comments_title: "üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏",
        modal_loading_post: "–ó–∞–≥—Ä—É–∑–∫–∞...",
        modal_no_comments: "üöÄ –ë—É–¥—å –ø–µ—Ä–≤—ã–º ‚Äî –æ—Å—Ç–∞–≤—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π",
        comment_placeholder: "–ù–∞–ø–∏—à–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π...",
        btn_send: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å",
        sending: "–û—Ç–ø—Ä–∞–≤–∫–∞...",

        must_login_comment: "üîê –ù—É–∂–Ω–æ –≤–æ–π—Ç–∏, —á—Ç–æ–±—ã –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å",
        copied_link: "–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!",
        could_not_send: "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π. –ü–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞.",

        footer_links: "–°—Å—ã–ª–∫–∏",
        footer_profile: "–¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å",
        footer_faq: "‚ùì –í–æ–ø—Ä–æ—Å—ã",
        footer_help: "–ü–æ–º–æ—â—å",
        footer_guide: "–ì–∞–π–¥ –ø–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏—é",
        footer_contact: "–ö–æ–Ω—Ç–∞–∫—Ç—ã",
        footer_support: "–¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞",
        footer_legal: "–ü—Ä–∞–≤–æ",
        footer_terms: "–£—Å–ª–æ–≤–∏—è",
        footer_privacy: "–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å",
        footer_cookies: "Cookies",
        footer_tagline_1: "–°–æ—Ü–∏–∞–ª—å–Ω–∞—è —Å–µ—Ç—å –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª–µ–π –∫–æ—Å–º–æ—Å–∞",
        footer_tagline_2: "–°–æ–µ–¥–∏–Ω—è–µ–º –∑–≤—ë–∑–¥—ã –∏ –ó–µ–º–ª—é",
        footer_quote_es: "–î–∞–∂–µ –µ—Å–ª–∏ –º—ã –∏–∑ —Ä–∞–∑–Ω—ã—Ö –≥–∞–ª–∞–∫—Ç–∏–∫, —Ç–≤–æ—è –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è –≤—ã–≤–æ–¥–∏–ª–∞ –º–µ–Ω—è –∏–∑ –æ—Ä–±–∏—Ç—ã",
        footer_quote_ru: "–≤—Å–µ —á—Ç–æ –º–Ω–µ –Ω—É–∂–Ω–æ —ç—Ç–æ —Ç—ã!",
        footer_created_by: "–°–æ–∑–¥–∞–Ω–æ <span class='creator-name'>Sebastian Sifuentes Zavala</span>",
        footer_rights: "–í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.",
        footer_rights_ru: "–í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.",

        post_detail_title: "üî≠ –î–µ—Ç–∞–ª–∏ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è",
        loading_post: "–ó–∞–≥—Ä—É–∑–∫–∞...",
        edit_btn: "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å",
        delete_btn: "–£–¥–∞–ª–∏—Ç—å",
        cancel_btn: "–û—Ç–º–µ–Ω–∞",
        save_btn: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",
        description: "–û–ø–∏—Å–∞–Ω–∏–µ",
        object_type: "–¢–∏–ø –æ–±—ä–µ–∫—Ç–∞",
        location: "–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ",
        type_satellite: "–°–ø—É—Ç–Ω–∏–∫",
        type_iss: "–ú–ö–°",
        type_starlink: "Starlink",
        type_rocket: "–†–∞–∫–µ—Ç–∞",
        type_meteor: "–ú–µ—Ç–µ–æ—Ä",
        type_space_debris: "–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –º—É—Å–æ—Ä",
        type_other: "–î—Ä—É–≥–æ–µ"
      }
    };

    const LOCALE_MAP = { es: "es-ES", en: "en-US", ru: "ru-RU" };
    let currentLang = "es";

    function t(key) {
      return (I18N[currentLang] && I18N[currentLang][key]) || (I18N.es[key] || key);
    }

    function applyI18n() {
      document.documentElement.lang = currentLang;
      document.documentElement.setAttribute("data-lang", currentLang);

      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.getAttribute("data-i18n");
        if (key === "footer_created_by") el.innerHTML = t(key);
        else el.textContent = t(key);
      });

      document.querySelectorAll("[data-i18n-placeholder]").forEach(el => {
        const key = el.getAttribute("data-i18n-placeholder");
        el.setAttribute("placeholder", t(key));
      });

      refreshRenderedPostLabels();
    }

    function setLanguage(lang) {
      currentLang = ["es","en","ru"].includes(lang) ? lang : "es";
      localStorage.setItem("lang", currentLang);
      const sel = document.getElementById("languageSelect");
      if (sel) sel.value = currentLang;
      applyI18n();
      loadPosts(true);
    }

    function loadLanguage() {
      const saved = localStorage.getItem("lang");
      currentLang = saved && ["es","en","ru"].includes(saved) ? saved : "es";
      const sel = document.getElementById("languageSelect");
      if (sel) sel.value = currentLang;
      applyI18n();
    }

    // ========= Navegaci√≥n m√≥vil =========
    const hamburgerBtn = document.getElementById("hamburgerBtn");
    const mobileMenu = document.getElementById("mobileMenu");

    hamburgerBtn.addEventListener("click", () => {
      mobileMenu.classList.toggle("active");
      hamburgerBtn.textContent = mobileMenu.classList.contains("active") ? "‚úï" : "‚ò∞";
    });

    mobileMenu.addEventListener("click", (e) => {
      if (e.target.tagName === "A") {
        mobileMenu.classList.remove("active");
        hamburgerBtn.textContent = "‚ò∞";
      }
    });

    // ========= Configuraci√≥n de Firebase =========
    const firebaseConfig = {
      apiKey: "AIzaSyD9cbm72_ikcQ5riFjv9ydcvBo-4OTvdYI",
      authDomain: "redview-59ebc.firebaseapp.com",
      databaseURL: "https://redview-59ebc-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "redview-59ebc",
      storageBucket: "redview-59ebc.firebasestorage.app",
      messagingSenderId: "618471660309",
      appId: "1:618471660309:web:91c0b1a11d71925802671c"
    };

    try {
      firebase.initializeApp(firebaseConfig);
      console.log("‚úÖ Firebase inicializado correctamente");
    } catch (error) {
      console.error("‚ùå Error al inicializar Firebase:", error);
    }

    // ========= Variables globales =========
    let currentPostId = null;
    let currentUserData = null;
    let postsListenerAttached = false;
    let currentEditingPostId = null;
    let isEditMode = false;

    // ========= Sesi√≥n =========
    function checkSession() {
      const currentUser = localStorage.getItem("currentUser");

      const authButtons = document.getElementById("authButtons");
      const userButtons = document.getElementById("userButtons");
      const userNameDisplay = document.getElementById("userNameDisplay");
      const createPostBtn = document.getElementById("createPostBtn");
      const heroSignupBtn = document.getElementById("heroSignupBtn");

      const authButtonsMobile = document.getElementById("authButtonsMobile");
      const userButtonsMobile = document.getElementById("userButtonsMobile");

      if (currentUser) {
        const user = JSON.parse(currentUser);

        authButtons.style.display = "none";
        userButtons.style.display = "flex";
        userNameDisplay.textContent = user.username;

        authButtonsMobile.style.display = "none";
        userButtonsMobile.style.display = "flex";

        createPostBtn.style.display = "inline-flex";
        createPostBtn.onclick = () => window.location.href = "create-post.html";
        heroSignupBtn.style.display = "none";
      } else {
        userButtons.style.display = "none";
        authButtons.style.display = "flex";

        userButtonsMobile.style.display = "none";
        authButtonsMobile.style.display = "flex";

        createPostBtn.style.display = "none";
        createPostBtn.onclick = () => window.location.href = "login.html";
        heroSignupBtn.style.display = "inline-flex";
      }
    }

    function logout() {
      localStorage.removeItem("currentUser");
      checkSession();
      window.location.href = "index.html";
    }

    // ========= Formatos =========
    function formatDate(dateString) {
      if (!dateString) return t("date_not_specified");
      const date = new Date(dateString);

      const locale = LOCALE_MAP[currentLang] || "es-ES";
      try {
        return new Intl.DateTimeFormat(locale, {
          year: "numeric",
          month: "short",
          day: "numeric",
          hour: "2-digit",
          minute: "2-digit"
        }).format(date);
      } catch {
        return date.toLocaleString();
      }
    }

    function formatLocation(location) {
      if (!location) return t("location_not_specified");
      const coords = String(location).split(",");
      if (coords.length === 2 && !isNaN(parseFloat(coords[0])) && !isNaN(parseFloat(coords[1]))) {
        return `${parseFloat(coords[0]).toFixed(2)}¬∞, ${parseFloat(coords[1]).toFixed(2)}¬∞`;
      }
      return location;
    }

    function getObjectTypeLabel(type) {
      const labels = {
        es: {
          satellite: "Sat√©lite", iss: "ISS", starlink: "Starlink",
          rocket: "Cohete", meteor: "Meteorito",
          space_debris: "Basura Espacial", other: "Otro"
        },
        en: {
          satellite: "Satellite", iss: "ISS", starlink: "Starlink",
          rocket: "Rocket", meteor: "Meteor",
          space_debris: "Space Debris", other: "Other"
        },
        ru: {
          satellite: "–°–ø—É—Ç–Ω–∏–∫", iss: "–ú–ö–°", starlink: "Starlink",
          rocket: "–†–∞–∫–µ—Ç–∞", meteor: "–ú–µ—Ç–µ–æ—Ä",
          space_debris: "–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –º—É—Å–æ—Ä", other: "–î—Ä—É–≥–æ–µ"
        }
      };

      return (labels[currentLang] && labels[currentLang][type]) || type || "‚Äî";
    }

    function escapeHtml(text) {
      const div = document.createElement("div");
      div.textContent = text ?? "";
      return div.innerHTML;
    }

    function refreshRenderedPostLabels() {
      document.querySelectorAll(".action-share-label").forEach(el => el.textContent = t("share_label"));
    }

    // ========= publicaci√≥n =========
    function loadPosts(forceRerender = false) {
      const postsGrid = document.getElementById("postsGrid");
      const dbRef = firebase.database().ref("posts");

      if (postsListenerAttached && !forceRerender) return;

      if (forceRerender && postsListenerAttached) {
        dbRef.off();
        postsListenerAttached = false;
      }

      postsListenerAttached = true;

      postsGrid.innerHTML = `
        <div class="loading-container">
          <div class="loading-spinner"></div>
          <p>${t("loading_posts")}</p>
        </div>
      `;

      dbRef.orderByChild("time").limitToLast(50).on("value", (snapshot) => {
        const posts = [];
        snapshot.forEach((childSnapshot) => {
          posts.push({ id: childSnapshot.key, ...childSnapshot.val() });
        });

        const sortedPosts = [...posts].sort((a, b) => new Date(b.time) - new Date(a.time));

        if (sortedPosts.length === 0) {
          const isLogged = !!localStorage.getItem("currentUser");
          postsGrid.innerHTML = `
            <div style="text-align:center; padding: 40px 18px; color: var(--muted);">
              <h3 style="font-weight: 900;">${t("empty_title")}</h3>
              <p style="margin-top: 10px; font-size: 0.95em;">${t("empty_sub")}</p>

              ${isLogged ? `
                <button class="btn btn-signup"
                  style="margin-top: 18px; border: none; padding: 10px 22px; border-radius: 999px;"
                  onclick="window.location.href='create-post.html'">
                  ${t("empty_create_first")}
                </button>
              ` : `
                <button class="btn btn-login"
                  style="margin-top: 18px; background: transparent; border: 2px solid var(--accent1); color: var(--accent1); padding: 10px 22px; border-radius: 999px;"
                  onclick="window.location.href='login.html'">
                  ${t("empty_login_publish")}
                </button>
              `}
            </div>
          `;
          updateStats();
          return;
        }

        postsGrid.innerHTML = sortedPosts.map(post => {
          const username = post.username || "An√≥nimo";
          const avatar = post.avatar || (username.charAt(0).toUpperCase() || "üë§");
          const commentsCount = post.comments ? Object.keys(post.comments).length : 0;

          const safeDescription = escapeHtml(post.description || "");

          return `
            <div class="post-card" onclick="openPostDetailModal('${post.id}')">
              <div class="post-header">
                <div class="post-avatar">${escapeHtml(avatar)}</div>
                <div class="post-info">
                  <div class="post-username">${escapeHtml(username)}</div>
                  <div class="post-time">${formatDate(post.time)}</div>
                </div>
              </div>

              <div class="post-content">
                <p>${safeDescription}</p>
                ${post.image ? `<img src="${post.image}" alt="Post image" class="post-image" loading="lazy">` : ""}
              </div>

              <div class="post-meta">
                <span class="post-type">üõ∞Ô∏è ${getObjectTypeLabel(post.objectType)}</span>
                <span class="post-location">üìç ${formatLocation(post.location)}</span>
              </div>

              <div class="post-actions">
                <button class="action-btn" onclick="event.stopPropagation(); likePost('${post.id}')">
                  üëç <span class="action-count">${post.likes || 0}</span>
                </button>
                <button class="action-btn" onclick="event.stopPropagation(); openCommentsModal('${post.id}')">
                  üí¨ <span class="action-count">${commentsCount}</span>
                </button>
                <button class="action-btn" onclick="event.stopPropagation(); sharePost('${post.id}')">
                  üîÑ <span class="action-share-label">${t("share_label")}</span>
                </button>
              </div>
            </div>
          `;
        }).join("");

        updateStats();
      }, (error) => {
        console.error("Error al cargar posts:", error);
        postsGrid.innerHTML = `
          <div class="loading-container">
            <div style="color: var(--danger1); margin-top: 10px; font-weight: 900;">
              ${t("err_connection")}<br>
              <button class="btn btn-signup" style="margin-top: 15px; padding: 8px 20px; font-size: 0.9em;"
                onclick="location.reload()">
                ${t("retry")}
              </button>
            </div>
          </div>
        `;
      });
    }

    // ========= Interacciones =========
    function likePost(postId) {
      const postRef = firebase.database().ref("posts/" + postId);
      postRef.transaction(post => {
        if (post) {
          post.likes = (post.likes || 0) + 1;
          return post;
        }
      });
    }

    function sharePost(postId) {
      const postsRef = firebase.database().ref("posts/" + postId);
      postsRef.once("value", (snapshot) => {
        const post = snapshot.val();
        if (!post) return;

        const desc = (post.description || "").toString();
        const shareText = `REDVIEWER: ${desc.substring(0, 100)}${desc.length > 100 ? "..." : ""}`;

        if (navigator.share) {
          navigator.share({
            title: "REDVIEWER",
            text: shareText,
            url: window.location.href
          });
        } else {
          navigator.clipboard.writeText(`${shareText}\n${window.location.href}`);
          alert(t("copied_link"));
        }
      });
    }

    // ========= Modal de comentarios =========
    function openCommentsModal(postId) {
      currentPostId = postId;
      const modal = document.getElementById("commentsModal");
      const preview = document.getElementById("modalPostPreview");

      const storedUser = localStorage.getItem("currentUser");
      currentUserData = storedUser ? JSON.parse(storedUser) : null;

      modal.classList.add("active");
      document.body.style.overflow = "hidden";

      preview.textContent = t("modal_loading_post");

      const postRef = firebase.database().ref("posts/" + postId);
      postRef.once("value", (snapshot) => {
        const post = snapshot.val();
        if (post) {
          const u = post.username || "An√≥nimo";
          const d = (post.description || "").toString();
          preview.innerHTML = `
            <strong style="color: var(--accent1);">${escapeHtml(u)}:</strong>
            ${escapeHtml(d.substring(0, 150))}${d.length > 150 ? "..." : ""}
          `;
          loadComments(postId);
        }
      });

      setTimeout(() => {
        document.getElementById("commentInput").focus();
      }, 250);
    }

    function closeCommentsModal() {
      const modal = document.getElementById("commentsModal");
      modal.classList.remove("active");
      document.body.style.overflow = "";
      currentPostId = null;
      document.getElementById("commentForm").reset();
    }

    document.getElementById("commentsModal")?.addEventListener("click", (e) => {
      if (e.target.id === "commentsModal") closeCommentsModal();
    });

    function loadComments(postId) {
      const commentsList = document.getElementById("modalCommentsList");
      const commentsRef = firebase.database().ref("posts/" + postId + "/comments");

      commentsList.innerHTML = `
        <div style="text-align: center; padding: 20px; color: var(--muted);">
          <div class="loading-spinner" style="width: 30px; height: 30px; margin: 0 auto 10px; border-width: 3px;"></div>
          ${t("loading_posts").replace("observaciones","comentarios").replace("sightings","comments")}
        </div>
      `;

      commentsRef.on("value", (snapshot) => {
        const comments = [];
        snapshot.forEach((childSnapshot) => {
          comments.push({ id: childSnapshot.key, ...childSnapshot.val() });
        });

        comments.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

        if (comments.length === 0) {
          commentsList.innerHTML = `<div class="comment-empty">${t("modal_no_comments")}</div>`;
          return;
        }

        commentsList.innerHTML = comments.map(comment => {
          const avatar = comment.avatar || (comment.username?.charAt(0).toUpperCase()) || "üë§";
          return `
            <div class="comment-item">
              <div class="comment-avatar">${escapeHtml(avatar)}</div>
              <div class="comment-body">
                <div class="comment-header">
                  <span class="comment-username">${escapeHtml(comment.username || "An√≥nimo")}</span>
                  <span class="comment-time">${formatDate(comment.timestamp)}</span>
                </div>
                <p class="comment-text">${escapeHtml(comment.text || "")}</p>
              </div>
            </div>
          `;
        }).join("");

        commentsList.scrollTop = commentsList.scrollHeight;
      });
    }

    function submitComment(event) {
      event.preventDefault();
      if (!currentPostId) return;

      const input = document.getElementById("commentInput");
      const sendBtn = document.getElementById("commentSendBtn");
      const text = input.value.trim();
      if (!text) return;

      const currentUser = localStorage.getItem("currentUser");
      if (!currentUser) {
        alert(t("must_login_comment"));
        window.location.href = "login.html";
        return;
      }

      const userData = JSON.parse(currentUser);
      sendBtn.disabled = true;
      sendBtn.textContent = t("sending");

      const newComment = {
        username: userData.username,
        avatar: userData.avatar,
        text: text,
        timestamp: firebase.database.ServerValue.TIMESTAMP,
        userId: userData.id
      };

      const commentsRef = firebase.database().ref("posts/" + currentPostId + "/comments");
      commentsRef.push(newComment)
        .then(() => {
          input.value = "";
          updateCommentsCount(currentPostId);
        })
        .catch((error) => {
          console.error("Error al enviar comentario:", error);
          alert(t("could_not_send"));
        })
        .finally(() => {
          sendBtn.disabled = false;
          sendBtn.textContent = t("btn_send");
          input.focus();
        });
    }

    function updateCommentsCount(postId) {
      const postRef = firebase.database().ref("posts/" + postId);
      postRef.once("value", (snapshot) => {
        const post = snapshot.val();
        const count = post?.comments ? Object.keys(post.comments).length : 0;

        document.querySelectorAll(`.post-card[onclick*="${postId}"] .action-btn:nth-child(2) .action-count`)
          .forEach(el => el.textContent = count);
      });
    }

    // ========= MODAL DE DETALLE DEL POST =========
    function openPostDetailModal(postId) {
      currentEditingPostId = postId;
      isEditMode = false; // Iniciamos en modo vista
      const modal = document.getElementById("postDetailModal");
      modal.classList.add("active");
      document.body.style.overflow = "hidden";

      loadPostDetail(postId);
    }

    function closePostDetailModal() {
      const modal = document.getElementById("postDetailModal");
      modal.classList.remove("active");
      document.body.style.overflow = "";
      currentEditingPostId = null;
      isEditMode = false;
    }

    function loadPostDetail(postId) {
      const contentDiv = document.getElementById("postDetailContent");
      const actionsDiv = document.getElementById("postDetailActions");

      contentDiv.innerHTML = `
        <div class="loading-container">
          <div class="loading-spinner"></div>
          <p>${t("loading_posts")}</p>
        </div>
      `;
      actionsDiv.style.display = "none";

      const postRef = firebase.database().ref("posts/" + postId);
      postRef.once("value", (snapshot) => {
        const post = snapshot.val();
        if (!post) {
          contentDiv.innerHTML = `<p style="color: var(--danger1);">‚ùå El post ya no existe.</p>`;
          return;
        }

        const currentUser = localStorage.getItem("currentUser");
        const isOwner = currentUser && JSON.parse(currentUser).id === post.userId;

        if (isEditMode) {
          renderEditForm(post);
        } else {
          renderPostDetail(post, isOwner);
        }

        if (isOwner && !isEditMode) {
          actionsDiv.style.display = "flex";
          actionsDiv.innerHTML = `
            <button class="btn btn-login" onclick="enableEditMode()" style="border-color: var(--accent2); color: var(--accent2);">‚úèÔ∏è ${t("edit_btn")}</button>
            <button class="btn btn-logout" onclick="deletePost()">üóëÔ∏è ${t("delete_btn")}</button>
          `;
        } else {
          actionsDiv.style.display = "none";
        }
      });
    }

    function renderPostDetail(post, isOwner) {
      const contentDiv = document.getElementById("postDetailContent");
      const username = escapeHtml(post.username || "An√≥nimo");
      const description = escapeHtml(post.description || "");
      const image = post.image ? `<img src="${post.image}" alt="Post image" style="width: 100%; max-height: 500px; object-fit: contain; border-radius: 12px; margin: 10px 0;">` : "";
      const typeLabel = getObjectTypeLabel(post.objectType);
      const location = formatLocation(post.location);
      const date = formatDate(post.time);

      contentDiv.innerHTML = `
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
          <div class="post-avatar">${escapeHtml(post.avatar || username.charAt(0))}</div>
          <div>
            <div style="font-weight: 900; color: var(--accent1);">${username}</div>
            <div style="color: var(--muted); font-size: 0.9em;">${date}</div>
          </div>
        </div>
        ${image}
        <p style="font-size: 1.1em; line-height: 1.6; margin: 8px 0;">${description}</p>
        <div style="display: flex; gap: 12px; flex-wrap: wrap; background: rgba(255,255,255,0.05); padding: 12px; border-radius: 10px; margin-top: 10px;">
          <span class="post-type">üõ∞Ô∏è ${typeLabel}</span>
          <span class="post-location">üìç ${location}</span>
        </div>
      `;
    }

    function renderEditForm(post) {
      const contentDiv = document.getElementById("postDetailContent");
      const description = post.description || "";
      const objectType = post.objectType || "satellite";
      const location = post.location || "";

      const typeOptions = [
        { value: "satellite", label: t("type_satellite") },
        { value: "iss", label: t("type_iss") },
        { value: "starlink", label: t("type_starlink") },
        { value: "rocket", label: t("type_rocket") },
        { value: "meteor", label: t("type_meteor") },
        { value: "space_debris", label: t("type_space_debris") },
        { value: "other", label: t("type_other") }
      ];

      const optionsHtml = typeOptions.map(opt => 
        `<option value="${opt.value}" ${opt.value === objectType ? "selected" : ""}>${opt.label}</option>`
      ).join("");

      contentDiv.innerHTML = `
        <form id="editPostForm" style="display: flex; flex-direction: column; gap: 16px;">
          <div>
            <label style="display: block; margin-bottom: 6px; color: var(--accent1); font-weight: 900;">${t("description")}</label>
            <textarea name="description" rows="4" style="width: 100%; background: rgba(255,255,255,0.1); border: 1px solid var(--borderGlass); border-radius: 10px; padding: 10px; color: #fff; font-size: 1em;">${escapeHtml(description)}</textarea>
          </div>
          <div>
            <label style="display: block; margin-bottom: 6px; color: var(--accent1); font-weight: 900;">${t("object_type")}</label>
            <select name="objectType" style="width: 100%; background: rgba(255,255,255,0.1); border: 1px solid var(--borderGlass); border-radius: 10px; padding: 10px; color: #fff;">
              ${optionsHtml}
            </select>
          </div>
          <div>
            <label style="display: block; margin-bottom: 6px; color: var(--accent1); font-weight: 900;">${t("location")}</label>
            <input type="text" name="location" value="${escapeHtml(location)}" style="width: 100%; background: rgba(255,255,255,0.1); border: 1px solid var(--borderGlass); border-radius: 10px; padding: 10px; color: #fff;">
          </div>
          <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 8px;">
            <button type="button" class="btn btn-login" onclick="cancelEdit()">${t("cancel_btn")}</button>
            <button type="submit" class="btn btn-signup">${t("save_btn")}</button>
          </div>
        </form>
      `;

      document.getElementById("editPostForm").addEventListener("submit", (e) => {
        e.preventDefault();
        savePostChanges();
      });
    }

    function enableEditMode() {
      isEditMode = true;
      const actionsDiv = document.getElementById("postDetailActions");
      actionsDiv.style.display = "none";
      loadPostDetail(currentEditingPostId);
    }

    function cancelEdit() {
      isEditMode = false;
      loadPostDetail(currentEditingPostId);
    }

    function savePostChanges() {
      const form = document.getElementById("editPostForm");
      if (!form) return;

      const updatedData = {
        description: form.description.value.trim(),
        objectType: form.objectType.value,
        location: form.location.value.trim()
      };

      if (!updatedData.description) {
        alert("La descripci√≥n no puede estar vac√≠a.");
        return;
      }

      const postRef = firebase.database().ref("posts/" + currentEditingPostId);
      postRef.update(updatedData)
        .then(() => {
          isEditMode = false;
          loadPostDetail(currentEditingPostId);
        })
        .catch(error => {
          console.error("Error al guardar cambios:", error);
          alert("‚ùå No se pudo guardar. Intenta de nuevo.");
        });
    }

    function deletePost() {
      if (!confirm("¬øEst√°s seguro de que deseas eliminar esta observaci√≥n? Esta acci√≥n no se puede deshacer.")) {
        return;
      }

      const postRef = firebase.database().ref("posts/" + currentEditingPostId);
      postRef.remove()
        .then(() => {
          closePostDetailModal();
        })
        .catch(error => {
          console.error("Error al eliminar:", error);
          alert("‚ùå No se pudo eliminar. Intenta de nuevo.");
        });
    }

    document.getElementById("postDetailModal")?.addEventListener("click", (e) => {
      if (e.target.id === "postDetailModal") closePostDetailModal();
    });

    // ========= Estadisticas =========
    function updateStats() {
      const postsRef = firebase.database().ref("posts");
      postsRef.once("value", (snapshot) => {
        const posts = [];
        snapshot.forEach((childSnapshot) => posts.push(childSnapshot.val()));

        const users = JSON.parse(localStorage.getItem("users")) || [];

        document.getElementById("totalPosts").textContent = posts.length;
        document.getElementById("totalUsers").textContent = users.length;
        document.getElementById("totalLikes").textContent = posts.reduce((sum, p) => sum + (p.likes || 0), 0);
        document.getElementById("totalComments").textContent = posts.reduce((sum, p) => {
          if (p.comments) {
            return sum + (Array.isArray(p.comments) ? p.comments.length : Object.keys(p.comments).length);
          }
          return sum;
        }, 0);
      });
    }

    // ========= Fondo de estrellas en moviemiento =========
    function createStars() {
      const container = document.getElementById("stars-container");
      const numStars = 200; // cantidad de estrellas

      for (let i = 0; i < numStars; i++) {
        const star = document.createElement("div");
        star.className = "star";

        // Tama√±o aleatorio entre 1px y 4px
        const size = Math.random() * 3 + 1;
        star.style.setProperty("--size", `${size}px`);

        // Posici√≥n aleatoria
        star.style.left = Math.random() * 100 + "%";
        star.style.top = Math.random() * 100 + "%";

        // Duraci√≥n de parpadeo entre 2s y 6s
        const duration = Math.random() * 4 + 2;
        star.style.setProperty("--duration", `${duration}s`);

        // Base de la opacidad
        star.style.setProperty("--opacity", Math.random() * 0.8 + 0.2);

        container.appendChild(star);
      }
    }

    // ========= Iniciacion =========
    window.onload = function() {
      console.log("üöÄ Iniciando REDVIEWER...");

      // Creaci√≥n de estrellas para el fondo 
      createStars();

      loadLanguage();
      document.getElementById("languageSelect").addEventListener("change", (e) => setLanguage(e.target.value));

      checkSession();
      loadPosts();

      console.log("‚úÖ REDVIEWER cargado correctamente");
    };
  </script>
</body>
</html>
